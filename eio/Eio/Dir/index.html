<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dir (eio.Eio.Dir)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">eio</a> &#x00BB; <a href="../index.html">Eio</a> &#x00BB; Dir</nav><header class="odoc-preamble"><h1>Module <code><span>Eio.Dir</span></code></h1><p>File-system access.</p><p>A <code>Dir.t</code> represents access to a directory and contents, recursively.</p><p><a href="../Stdenv/index.html#val-fs"><code>Stdenv.fs</code></a> provides access to the whole file-system.</p><p>Example:</p><pre><code>Eio.Dir.load fs &quot;/etc/passwd&quot;</code></pre></header><nav class="odoc-toc"><ul><li><a href="#reading-files">Reading files</a></li><li><a href="#writing-files">Writing files</a></li><li><a href="#directories">Directories</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Unix_perm" class="anchored"><a href="#module-Unix_perm" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Unix_perm/index.html">Unix_perm</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Tranditional Unix permissions.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-path" class="anchored"><a href="#type-path" class="anchor"></a><code><span><span class="keyword">type</span> path</span><span> = string</span></code></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Already_exists" class="anchored"><a href="#exception-Already_exists" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Already_exists</span> <span class="keyword">of</span> <a href="#type-path">path</a> * exn</span></code></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Not_found" class="anchored"><a href="#exception-Not_found" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Not_found</span> <span class="keyword">of</span> <a href="#type-path">path</a> * exn</span></code></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Permission_denied" class="anchored"><a href="#exception-Permission_denied" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Permission_denied</span> <span class="keyword">of</span> <a href="#type-path">path</a> * exn</span></code></div></div><div class="odoc-spec"><div class="spec class" id="class-rw" class="anchored"><a href="#class-rw" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span>  </span><span><a href="class-rw/index.html">rw</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-create" class="anchored"><a href="#type-create" class="anchor"></a><code><span><span class="keyword">type</span> create</span><span> = </span><span>[ </span></code><table><tr id="type-create.Never" class="anchored"><td class="def constructor"><a href="#type-create.Never" class="anchor"></a><code><span>| </span></code><code><span>`Never</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>fail if the named file doesn't exist</p><span class="comment-delim">*)</span></td></tr><tr id="type-create.If_missing" class="anchored"><td class="def constructor"><a href="#type-create.If_missing" class="anchor"></a><code><span>| </span></code><code><span>`If_missing <span class="keyword">of</span> <a href="Unix_perm/index.html#type-t">Unix_perm.t</a></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>create if file doesn't already exist</p><span class="comment-delim">*)</span></td></tr><tr id="type-create.Or_truncate" class="anchored"><td class="def constructor"><a href="#type-create.Or_truncate" class="anchor"></a><code><span>| </span></code><code><span>`Or_truncate <span class="keyword">of</span> <a href="Unix_perm/index.html#type-t">Unix_perm.t</a></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>any existing file is truncated to zero length</p><span class="comment-delim">*)</span></td></tr><tr id="type-create.Exclusive" class="anchored"><td class="def constructor"><a href="#type-create.Exclusive" class="anchor"></a><code><span>| </span></code><code><span>`Exclusive <span class="keyword">of</span> <a href="Unix_perm/index.html#type-t">Unix_perm.t</a></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>always create; fail if the file already exists</p><span class="comment-delim">*)</span></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>When to create a new file.</p><p>If a new file is created, the given permissions are used for it.</p></div></div><div class="odoc-spec"><div class="spec class" id="class-t" class="anchored"><a href="#class-t" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span>  </span><span><a href="class-t/index.html">t</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec class" id="class-t_with_close" class="anchored"><a href="#class-t_with_close" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span>  </span><span><a href="class-t_with_close/index.html">t_with_close</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="reading-files"><a href="#reading-files" class="anchor"></a>Reading files</h2><div class="odoc-spec"><div class="spec value" id="val-load" class="anchored"><a href="#val-load" class="anchor"></a><code><span><span class="keyword">val</span> load : <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>load t path</code> returns the contents of the given file.</p><p>This is a convenience wrapper around <a href="#val-with_open_in"><code>with_open_in</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-open_in" class="anchored"><a href="#val-open_in" class="anchor"></a><code><span><span class="keyword">val</span> open_in : <span>sw:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span>&lt; <a href="../Flow/class-source/index.html">Flow.source</a> ; <a href="../Flow/class-type-close/index.html">Flow.close</a> &gt;</span></span></code></div><div class="spec-doc"><p><code>open_in ~sw t path</code> opens <code>t/path</code> for reading.</p><p>Note: files are always opened in binary mode.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_open_in" class="anchored"><a href="#val-with_open_in" class="anchor"></a><code><span><span class="keyword">val</span> with_open_in : <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span>( <span><span>&lt; <a href="../Flow/class-source/index.html">Flow.source</a> ; <a href="../Flow/class-type-close/index.html">Flow.close</a> &gt;</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> )</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_open_in</code> is like <code>open_in</code>, but calls <code>fn flow</code> with the new flow and closes it automatically when <code>fn</code> returns (if it hasn't already been closed by then).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_lines" class="anchored"><a href="#val-with_lines" class="anchor"></a><code><span><span class="keyword">val</span> with_lines : <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span>( <span><span>string <span class="xref-unresolved">Stdlib</span>.Seq.t</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> )</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_lines t path fn</code> is a convenience function for streaming the lines of the file.</p><p>It uses <a href="../Buf_read/index.html#val-lines"><code>Buf_read.lines</code></a>.</p></div></div><h2 id="writing-files"><a href="#writing-files" class="anchor"></a>Writing files</h2><div class="odoc-spec"><div class="spec value" id="val-save" class="anchored"><a href="#val-save" class="anchor"></a><code><span><span class="keyword">val</span> save : <span>?append:bool <span class="arrow">&#45;&gt;</span></span> <span>create:<a href="#type-create">create</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>save t path data ~create</code> writes <code>data</code> to <code>path</code>.</p><p>This is a convenience wrapper around <a href="#val-with_open_out"><code>with_open_out</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-open_out" class="anchored"><a href="#val-open_out" class="anchor"></a><code><span><span class="keyword">val</span> open_out : 
  <span>sw:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?append:bool <span class="arrow">&#45;&gt;</span></span>
  <span>create:<a href="#type-create">create</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span>&lt; <a href="class-rw/index.html">rw</a>
  ; <a href="../Flow/class-type-close/index.html">Flow.close</a> &gt;</span></span></code></div><div class="spec-doc"><p><code>open_out ~sw t path</code> opens <code>t/path</code> for reading and writing.</p><p>Note: files are always opened in binary mode.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">append</span> <p>Open for appending: always write at end of file.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">create</span> <p>Controls whether to create the file, and what permissions to give it if so.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-with_open_out" class="anchored"><a href="#val-with_open_out" class="anchor"></a><code><span><span class="keyword">val</span> with_open_out : 
  <span>?append:bool <span class="arrow">&#45;&gt;</span></span>
  <span>create:<a href="#type-create">create</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span>&lt; <a href="class-rw/index.html">rw</a> ; <a href="../Flow/class-type-close/index.html">Flow.close</a> &gt;</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_open_out</code> is like <code>open_out</code>, but calls <code>fn flow</code> with the new flow and closes it automatically when <code>fn</code> returns (if it hasn't already been closed by then).</p></div></div><h2 id="directories"><a href="#directories" class="anchor"></a>Directories</h2><div class="odoc-spec"><div class="spec value" id="val-mkdir" class="anchored"><a href="#val-mkdir" class="anchor"></a><code><span><span class="keyword">val</span> mkdir : <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span>perm:<a href="Unix_perm/index.html#type-t">Unix_perm.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>mkdir t ~perm path</code> creates a new directory <code>t/path</code> with permissions <code>perm</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-open_dir" class="anchored"><a href="#val-open_dir" class="anchor"></a><code><span><span class="keyword">val</span> open_dir : <span>sw:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span>&lt; <a href="class-t/index.html">t</a> ; <a href="../Flow/class-type-close/index.html">Flow.close</a> &gt;</span></span></code></div><div class="spec-doc"><p><code>open_dir ~sw t path</code> opens <code>t/path</code>.</p><p>This can be passed to functions to grant access only to the subtree <code>t/path</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_open_dir" class="anchored"><a href="#val-with_open_dir" class="anchor"></a><code><span><span class="keyword">val</span> with_open_dir : <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span>( <span><span>&lt; <a href="class-t/index.html">t</a> ; <a href="../Flow/class-type-close/index.html">Flow.close</a> &gt;</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> )</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_open_dir</code> is like <code>open_dir</code>, but calls <code>fn dir</code> with the new directory and closes it automatically when <code>fn</code> returns (if it hasn't already been closed by then).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_dir" class="anchored"><a href="#val-read_dir" class="anchor"></a><code><span><span class="keyword">val</span> read_dir : <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>read_dir t path</code> reads directory entries for <code>t/path</code>. The entries are sorted using <code>String</code>.compare.</p></div></div></div></body></html>